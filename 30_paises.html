<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        tr{
          background-color: rgb(242, 250, 255);

        }
        .centrado{
            text-align: center;
        }
        td{
            text-align: left;
            padding: 5px;
            border-bottom: 2px solid rgb(177, 177, 177);


        }
        th{
            text-align: left;
            padding: 5px;
            border-bottom: 3px solid black;
        }

    </style>
</head>
<body>
    ELIGE UNA BASE DE DATOS <input type="file" id="baseDatosPaises">
    <br><br>
    <h1>BASE DE DATOS DE PAISES</h1>
    <h3>Elige una región</h3>
    <select id="regiones">
        
    </select>
    <hr>
    <h3>PAISES DE LA REGIÓN</h3>
    <br>
        <table id="tablaPaises">
        </table>

    <div id="prueba">PRUEBA TEXTO</div>
    <script>
        let informacionPaises=[];
        let listaRegiones=new Set();

        document.getElementById("baseDatosPaises").addEventListener("change",(event)=>{
            let fichero=event.target.files[0];//el fichero es el archivo en posición 0 de los que hemos cogido de baseDatosPaises
            let lector=new FileReader();
            
                lector.onload=(fichero)=>{
                    informacionPaises=JSON.parse(fichero.target.result);
                    crearSelect();
                    //console.log("esta es informacion paises "+informacionPaises);
                };

                lector.onerror=()=>alert("error en el documento");

                lector.readAsText(fichero);

        });

            //configuramos el select dentro del evento cargar archivo
    function crearSelect(){
            let selectRegiones="<option selected>Todos</option>";
            informacionPaises.forEach((a)=>{listaRegiones.add(a.region);});
            listaRegiones.forEach((region)=>{
                selectRegiones+=`<option>${region}</option>`
            });
            document.getElementById("regiones").innerHTML=selectRegiones;
            document.getElementById("regiones").addEventListener("focus",crearLista);
            document.getElementById("regiones").focus();

        };


        //evento para cuando seleccionamos la región en el select
    document.getElementById("regiones").addEventListener("change",crearLista);
    
    
    function crearLista(){
        let listadoRegion="";
        let cabecera=`<tr><th>PAÍS</th><th>CAPITAL</th><th>POBLACION</th><th class="centrado">BANDERA</th></tr>`;
        let opcion=document.getElementById("regiones").value;

        if(opcion=="Todos"){
            informacionPaises.forEach((item)=>listadoRegion+=`<tr><td>${item.name}</td><td>${item.capital}</td><td>${item.population}</td><td class="centrado"><img src=${item.flag} height=15px; ></td></tr>`)
        }   else{
            informacionPaises.filter((item)=>item.region==opcion).forEach((item)=>{
            listadoRegion+=`<tr><td>${item.name}</td><td>${item.capital}</td><td>${item.population}</td><td class="centrado"><img src=${item.flag} height=15px; ></td></tr>`
            })
        };
                
        document.getElementById("tablaPaises").innerHTML=cabecera+listadoRegion;
    };


    </script>
    
</body>
</html>

